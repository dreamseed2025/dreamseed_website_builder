<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Widget Test - DreamSeed</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .demo-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .demo-section h2 {
            margin-top: 0;
            color: #ffd700;
        }
        
        .voice-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff4757 0%, #ff6b7a 100%);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(255, 71, 87, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .voice-widget:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(255, 71, 87, 0.6);
        }
        
        .voice-widget.listening {
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .conversation {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 8px;
        }
        
        .message.user {
            background: rgba(255, 255, 255, 0.2);
            margin-left: 20%;
        }
        
        .message.assistant {
            background: rgba(102, 126, 234, 0.3);
            margin-right: 20%;
        }
        
        .status {
            text-align: center;
            font-weight: bold;
            margin: 10px 0;
            padding: 10px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a67d8;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .error {
            background: rgba(255, 71, 87, 0.3);
            color: #ffebee;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ¤ Voice Widget Test</h1>
        
        <div class="demo-section">
            <h2>âœ¨ Features</h2>
            <ul>
                <li>ðŸŽ¯ Dynamic system messages based on user ID and dream ID</li>
                <li>ðŸŽ¤ Voice interrupt handling</li>
                <li>ðŸ¤– OpenAI Whisper integration for speech-to-text</li>
                <li>ðŸ“Š Conversation history with timestamps</li>
                <li>ðŸŽµ Real-time audio visualization</li>
                <li>ðŸ“± Responsive design for all devices</li>
            </ul>
        </div>
        
        <div class="demo-section">
            <h2>ðŸš€ How to Test</h2>
            <ol>
                <li>Click the microphone button in the bottom-right corner</li>
                <li>Allow microphone access when prompted</li>
                <li>Start speaking naturally</li>
                <li>Try interrupting the AI while it's speaking</li>
                <li>Watch the conversation history build up</li>
            </ol>
        </div>
        
        <div class="demo-section">
            <h2>ðŸ’¡ Example Phrases</h2>
            <div class="controls">
                <button class="btn btn-secondary" onclick="testPhrase('Help me form an LLC for my consulting business')">Business Formation</button>
                <button class="btn btn-secondary" onclick="testPhrase('I need a domain name for my tech startup')">Domain Search</button>
                <button class="btn btn-secondary" onclick="testPhrase('What are the steps to register my business in California?')">State Registration</button>
            </div>
        </div>
        
        <div class="demo-section">
            <h2>ðŸ“Š Current Status</h2>
            <div id="status" class="status">Ready to start voice conversation</div>
            <div id="error" class="error" style="display: none;"></div>
        </div>
        
        <div class="demo-section">
            <h2>ðŸ’¬ Conversation History</h2>
            <div id="conversation" class="conversation">
                <div class="message assistant">Hello! I'm your AI voice assistant. Click the microphone button to start speaking with me.</div>
            </div>
        </div>
    </div>
    
    <!-- Voice Widget Button -->
    <button id="voiceWidget" class="voice-widget" onclick="toggleVoiceWidget()">
        ðŸŽ¤
    </button>
    
    <script>
        let isListening = false;
        let recognition = null;
        let synthesis = window.speechSynthesis;
        
        // Initialize speech recognition
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
            } else if ('SpeechRecognition' in window) {
                recognition = new SpeechRecognition();
            } else {
                showError('Speech recognition is not supported in this browser');
                return false;
            }
            
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';
            
            recognition.onstart = () => {
                isListening = true;
                updateStatus('ðŸŽ¤ Listening... speak now!');
                document.getElementById('voiceWidget').classList.add('listening');
            };
            
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                addMessage(transcript, 'user');
                processUserInput(transcript);
            };
            
            recognition.onerror = (event) => {
                showError(`Speech recognition error: ${event.error}`);
                isListening = false;
                document.getElementById('voiceWidget').classList.remove('listening');
            };
            
            recognition.onend = () => {
                isListening = false;
                document.getElementById('voiceWidget').classList.remove('listening');
                updateStatus('Ready for next input');
            };
            
            return true;
        }
        
        function toggleVoiceWidget() {
            if (!recognition && !initSpeechRecognition()) {
                return;
            }
            
            if (isListening) {
                recognition.stop();
            } else {
                recognition.start();
            }
        }
        
        function addMessage(content, role) {
            const conversation = document.getElementById('conversation');
            const message = document.createElement('div');
            message.className = `message ${role}`;
            message.textContent = content;
            conversation.appendChild(message);
            conversation.scrollTop = conversation.scrollHeight;
        }
        
        function updateStatus(status) {
            document.getElementById('status').textContent = status;
        }
        
        function showError(error) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = error;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }
        
        function testPhrase(phrase) {
            addMessage(phrase, 'user');
            processUserInput(phrase);
        }
        
        function processUserInput(input) {
            updateStatus('ðŸ¤– Processing your request...');
            
            // Simulate AI processing
            setTimeout(() => {
                const responses = [
                    "Great question! I'd be happy to help you with that. Let me provide some guidance based on your specific needs.",
                    "That's an excellent topic to discuss. I can help you navigate through the process step by step.",
                    "I understand what you're looking for. Let me give you some actionable advice for your situation.",
                    "Perfect! This is exactly the kind of question I'm designed to help with. Here's what you need to know.",
                    "I'm glad you asked about that. Let me break down the key points for you."
                ];
                
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                addMessage(randomResponse, 'assistant');
                
                // Speak the response
                if (synthesis) {
                    const utterance = new SpeechSynthesisUtterance(randomResponse);
                    utterance.rate = 0.9;
                    utterance.pitch = 1;
                    synthesis.speak(utterance);
                }
                
                updateStatus('Ready for next input');
            }, 1500);
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            updateStatus('Voice widget ready - click the microphone to start!');
        });
    </script>
</body>
</html>
